<div class="container-fluid" ng-app="busRoutesApp">
  <div class="col-md-12" ng-controller="StudentCrudCtrl">
    <button id="goto-top" class="btn btn-primary" ng-click="gotoTop()">Top</button>
    <button id="goto-map" class="btn btn-primary" ng-click="gotoMap()">Map</button>
    <button id="add-new-student-button" class="btn btn-primary" ng-hide="formDisplay" ng-click="showForm()">Add A New Student</button>
    <div ng-cloak ng-show="formDisplay">
      <form id="add-student-form">
        <h2>Adding A New Student</h2>
        <div class="form-group">
          <input class="form-control" type="text" placeholder="First Name" ng-model="NewStudent.first_name">
          <input class="form-control" type="text" placeholder="Last Name" ng-model="NewStudent.last_name">
          <input class="form-control" type="text" placeholder="School" ng-model="NewStudent.school">
          <input class="form-control" type="text" placeholder="Grade" ng-model="NewStudent.grade">
          <input class="form-control" type="text" placeholder="Phone Number" ng-model="NewStudent.phone">
          <input class="form-control" type="text" placeholder="Additional Phone" ng-model="NewStudent.additional_phones">
          <input class="form-control" type="text" placeholder="Email Address" ng-model="NewStudent.email">
          <input class="form-control" type="text" placeholder="Additional Email" ng-model="NewStudent.additional_email">
          <input class="form-control" type="text" placeholder="Street Address" ng-model="NewStudent.street_address">
          <input class="form-control" type="text" placeholder="City" ng-model="NewStudent.city">
          <input class="form-control" type="text" placeholder="Postal Code" ng-model="NewStudent.postal_code">
          <input class="form-control" type="text" placeholder="Bus Route" ng-model="NewStudent.bus_route">
          <input class="form-control" type="text" placeholder="Stop" ng-model="NewStudent.stop">
          <input class="form-control" type="text" placeholder="Mon-Thurs Time" ng-model="NewStudent.mon_thurs">
          <input class="form-control" type="text" placeholder="Friday Time" ng-model="NewStudent.friday">
          <input class="form-control" type="text" placeholder="1 or 2 Way" ng-model="NewStudent.return_trip">
          <input class="form-control" type="text" placeholder="Parent Names" ng-model="NewStudent.parent_names">
          <input class="form-control" type="text" placeholder="Comments" ng-model="NewStudent.comments">
          <input class="btn btn-primary" id="add-student-submit" ng-click="addNewStudent()" type="submit" value="Add New Student">
        </div>
        <button class="btn btn-success" id="finished-adding-button" ng-cloak ng-show="formDisplay" ng-click="hideForm()">Finished Adding Students</button>
      </form>
      <div id="add-siblings">
        <h2>Add Siblings (optional)</h2>
        <button class="btn btn-primary add-sibling-button" ng-hide="showSiblings" ng-click="showSiblings = true">Add Siblings</button>
        <form ng-show="showSiblings">
          <h2>Sibling 1</h2>
          <div class="form-group">
            <input class="form-control" type="text" placeholder="First Name" ng-model="sibling1.first_name">
            <input class="form-control" type="text" placeholder="School" ng-model="sibling1.school">
            <input class="form-control" type="text" placeholder="Grade" ng-model="sibling1.grade">
          </div>
        </form>
        <form ng-show="showSiblings">
          <h2>Sibling 2</h2>
          <div class="form-group">
            <input class="form-control" type="text" placeholder="First Name" ng-model="sibling2.first_name">
            <input class="form-control" type="text" placeholder="School" ng-model="sibling2.school">
            <input class="form-control" type="text" placeholder="Grade" ng-model="sibling2.grade">
          </div>
        </form>
        <form ng-show="showSiblings">
          <h2>Sibling 3</h2>
          <div class="form-group">
            <input class="form-control" type="text" placeholder="First Name" ng-model="sibling3.first_name">
            <input class="form-control" type="text" placeholder="School" ng-model="sibling3.school">
            <input class="form-control" type="text" placeholder="Grade" ng-model="sibling3.grade">
          </div>
        </form>
        <form ng-show="showSiblings">
          <h2>Sibling 4</h2>
          <div class="form-group">
            <input class="form-control" type="text" placeholder="First Name" ng-model="sibling4.first_name">
            <input class="form-control" type="text" placeholder="School" ng-model="sibling4.school">
            <input class="form-control" type="text" placeholder="Grade" ng-model="sibling4.grade">
          </div>
        </form>
      </div>
    </div>
      <form id="edit-student-form"  ng-cloak ng-show="showEdit">
        <h1>Edit Student</h1>
        <div class="form-group">
          <label>First Name:</label><input class="form-control" type="text" ng-model="selectedStudent.first_name">
          <label>Last Name:</label><input class="form-control" type="text" ng-model="selectedStudent.last_name">
          <label>School:</label><input class="form-control" type="text" ng-model="selectedStudent.school">
          <label>Grade:</label><input class="form-control" type="text" ng-model="selectedStudent.grade">
          <label>Route:</label><input class="form-control" type="text" ng-model="selectedStudent.bus_route">
          <label>Stop:</label><input class="form-control" type="text" ng-model="selectedStudent.stop">
          <label>Mon-Thurs:</label><input class="form-control" type="text" ng-model="selectedStudent.mon_thurs">
          <label>Friday:</label><input class="form-control" type="text" ng-model="selectedStudent.friday">
          <label>1 or 2 Way:</label><input class="form-control" type="text" ng-model="selectedStudent.return_trip">
          <label>Phone:</label><input class="form-control" type="text" ng-model="selectedStudent.phone">
          <label>Additional Phone:</label><input class="form-control" type="text" ng-model="selectedStudent.additional_phones">
          <label>Email:</label><input class="form-control" type="text" ng-model="selectedStudent.email">
          <label>Additional Email:</label><input class="form-control" type="text" ng-model="selectedStudent.additional_email">
          <label>Parent Names:</label><input class="form-control" type="text" ng-model="selectedStudent.parent_names">
          <label>Address:</label><input class="form-control" type="text" ng-model="selectedStudent.street_address">
          <label>City:</label><input class="form-control" type="text" ng-model="selectedStudent.city">
          <label>Postal Code:</label><input class="form-control" type="text" ng-model="selectedStudent.postal_code">
          <label>Comments:</label><br>
          <textarea ng-model="selectedStudent.comments"></textarea> <br>
          <button ng-click="includeSiblings = true; updateStudent()" class="btn btn-primary" id="save-changes-button">Save Changes To Student And All Siblings</button>
          <button class="btn btn-primary" id="save-student-only" ng-click="updateStudent()">Only Save Changes To This Student</button>
          <button class="btn btn-success" id="close-without-saving" ng-click="showEdit = false; gotoTop()">Close Without Saving</button>
        </div>
      </form>
      <div class="search-box">
        SEARCH:
        <input class="form-control" type="text" placeholder="Search" ng-model="Search">
      </div>
      <div class="filter-criteria">
        FILTERS:
        <select ng-model="Route" ng-change="deleteRouteFilter()"> 
          <option value="" default selected>All Routes</option>
          <option value="!">No Route</option>
          <option value="101">101</option>
          <option value="102">102</option>
          <option value="103">103</option>
          <option value="104">104</option>
          <option value="105">105</option>
          <option value="106">106</option>
          <option value="107">107</option>
          <option value="108">108</option>
          <option value="201">201</option>
          <option value="202">202</option>
          <option value="203">203</option>
          <option value="204">204</option>
          <option value="205">205</option>
          <option value="206">206</option>
          <option value="207">207</option>
          <option value="208">208</option>
        </select>
        <select ng-model="School"> 
          <option value="" default selected>All Schools</option>
          <option value="SCS">Surrey Christian</option>
          <option value="LCS">Langley Christian</option>
          <option value="CCES">Credo Elementary</option>
          <option value="CCHS">Credo High</option>
          <option value="WO">William of Orange</option>
          <option value="CCS">Cloverdale Christian</option>
        </select>
        <select ng-model="City" >
          <option value="" default selected>All Cities</option>
          <option value="Surrey">Surrey</option>
          <option value="Langley">Langley</option>
          <option value="Cloverdale">Cloverdale</option>
          <option value="Abbotsford">Abbotsford</option>
          <option value="Delta">Delta</option>
          <option value="New Westminster">New Westminster</option>
          <option value="Coquitlam">Coquitlam</option>
          <option value="Burnaby">Burnaby</option>
          <option value="Port Coquitlam">Port Coquitlam</option>
          <option value="Port Moody">Port Moody</option>
          <option value="North Delta">North Delta</option>
          <option value="Aldergrove">Aldergrove</option>
          <option value="White Rock">White Rock</option>
          <option value="Fort Langley">Fort Langley</option>
        </select>
        ORDER By:
        <select ng-model="firstOrderSelection">
          <option value="last_name">Last Name</option>
          <option value="school">School</option>
          <option value="city">City</option>
        </select>
        <select ng-model="secondOrderSelection">
          <option value="" default selected>Secondary Ordering</option>
          <option value="last_name">Last Name</option>
          <option value="school">School</option>
          <option value="city">City</option>
        </select>
      </div>
      <p class="filter-results">
<!-- The results variable is populated by the ng-repeat directive below -->
        <ng-pluralize 
            count="shared.results.length"
            when="{'0': 'No students match the selected filter criteria',
                   '1': '1 student matches the selected filter criteria',
                   'other': '{} students match the selected filter criteria'}">
        </ng-pluralize>
      </p>
      <table>
        <tr> 
          <th>First Name</th>
          <th>Last Name</th>
          <th class="narrow">School</th>
          <th class="narrow">Grade</th>
          <th>Street Address</th>
          <th>City</th>
          <th class="narrow">Route</th>
          <th>Stop Location</th>
          <th class="narrow">M-T</th>
          <th class="narrow">Friday</th>
          <th class="narrow">1 or 2 Way</th>
          <th class="table-button"></th>
          <th class="table-button"></th>
          <th class="table-button"></th>
        </tr>
<!-- The 'as results' allows the result of the filter to be stored in a variable called results so the information can be used elsewhere. In this case it is used to display the number of students that meet the user's filter criteria. -->
<tr ng-repeat="student in (shared.results = (students | filter:Search | filter:{bus_route:Route} | filter:{school:School} |filter:City | orderBy:[firstOrderSelection, secondOrderSelection]))">
          <td>{{student.first_name}}</td>
          <td>{{student.last_name}}</td>
          <td>{{student.school}}</td>
          <td>{{student.grade}}</td>
          <td>{{student.street_address}}</td>
          <td>{{student.city}}</td>
          <td>{{student.bus_route}}</td>
          <td>{{student.stop}}</td>
          <td>{{student.mon_thurs}}</td>
          <td>{{student.friday}}</td>
          <td>{{student.return_trip}}</td>
          <td><button class="btn btn-info btn-xs details-button" ng-click="showStudent(student.id)">Details</button></td>
          <td><button class="btn btn-warning btn-xs edit-button" ng-click="editStudent(student.id)">Edit</button></td>
          <td><button class="btn btn-danger btn-xs delete-button" ng-click="removeStudent(student.id)">Delete</button></td>
        </tr>
      </table>
    <div>
      <button class="btn btn-success" ng-click="seatsFilled(shared.results)">Calculate Number of Seats Required For This Group</button>
      <span class="seats-required">{{seatsAssigned}}</span>
    </div>
      <ul id="details-list" ng-show="showDetails" ng-model="detailStudent">
        <h1>Student Details</h1>
        <li><span class="heading">Name:</span> {{detailStudent.first_name}} {{detailStudent.last_name}}</li>
        <li><span class="heading">Route:</span> {{detailStudent.bus_route}}</li>
        <li><span class="heading">Stop:</span> {{detailStudent.stop}}</li>
        <li><span class="heading">Mon-Thurs Time:</span> {{detailStudent.mon_thurs}}</li>
        <li><span class="heading">Friday Time:</span> {{detailStudent.friday}}</li>
        <li><span class="heading">Return:</span> {{detailStudent.return_trip}}</li>
        <li><span class="heading">School:</span> {{detailStudent.school}}</li>
        <li><span class="heading">Grade:</span> {{detailStudent.grade}}</li>
        <li><span class="heading">Phone:</span> {{detailStudent.phone}}</li>
        <li><span class="heading">Additional Phone:</span> {{detailStudent.addition_phones}}</li>
        <li><span class="heading">Email:</span> {{detailStudent.email}}</li>
        <li><span class="heading">Additional Email:</span> {{detailStudent.additional_email}}</li>
        <li><span class="heading">Parents:</span> {{detailStudent.parent_names}}</li>
        <li><span class="heading">Address:</span> {{detailStudent.street_address}}</li>
        <li><span class="heading">City:</span> {{detailStudent.city}}</li>
        <li><span class="heading">Postal Code:</span> {{detailStudent.postal_code}}</li>
        <li><span class="heading">Comments:</span>
          <div id="comment-details"><pre>{{detailStudent.comments}}</pre></div>
        </li>
        <li><span class="heading">Latitude:</span> {{detailStudent.latitude}}</li>
        <li><span class="heading">Longitude:</span> {{detailStudent.longitude}}</li>
      </ul>
  </div>
  <div class="col-md-12" ng-controller="MarkerCtrl">
    <button class="btn btn-primary" id="reset-markers" ng-click="resetMarkers(shared.results)">Show Only Students In List On Map</button> 
    <button class="btn btn-primary" id="add-markers" ng-click="addMarkers(shared.results)">Add Students In List To Map</button> 
  </div>
  <div class="col-md-12" ng-controller="RouteAssignmentCtrl">
    <div class="edit-single">
      <h3>Edit Route And Stop Info</h3>
      <p>Click on a student's marker icon to select him/her for editing route info.</p>
      <span>{{shared.clickedStudent.first_name}} {{shared.clickedStudent.last_name}}</span>
      <input class="form-control" type="text" placeholder="Route" ng-model="shared.clickedStudent.bus_route">
      <input class="form-control" type="text" placeholder="Stop" ng-model="shared.clickedStudent.stop">
      <input class="form-control" type="text" placeholder="Mon-Thurs Time" ng-model="shared.clickedStudent.mon_thurs">
      <input class="form-control" type="text" placeholder="Friday Time" ng-model="shared.clickedStudent.friday">
      <button class="btn btn-primary" ng-click="updateStudentRouteInfo()">Update Student</button>
    </div>
    <button class="btn btn-success btn-lg" id="start-selecting-students" ng-hide="shared.beginSelection" ng-click="shared.beginSelection = true">Click Here To Enter Bulk Route Assignment Mode</button>
    <div class="multiple-edit" ng-show="shared.beginSelection">
      <h3>Bulk Edit Route Info</h3>
      <p>You are in Bulk Route Assignment mode.
        <button class="btn btn-success" ng-click="shared.beginSelection = false">Click here to exit this mode</button>
      </p>
      <input type="text" placeholder="Route" ng-model="bulkAssignmentRoute">
      <ul ng-repeat="selection in shared.selections">
        <li>
          {{selection.first_name}} {{selection.last_name}}
          <button class="btn btn-danger btn-xs" ng-show="selection.topSibling" ng-click="removeFromSelections(selection.id, $index)">Remove</button>
        </li>
      </ul>
    <button class="btn btn-info" ng-click="clearSelected()">Clear Students</button>
    <button class="btn btn-primary" ng-click="massAssignRoute()">Assign Route To Selected Students</button>
    </div>
  </div>
  <div class="col-md-12" id="map-display" ng-controller="MapCtrl">
    <button class="btn btn-success" ng-click="printMap()">Print Map</button> 
    <div id="map-canvas">
    </div>
  </div>
</div>
